<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Persistence :: Automatiko</title>
    <link rel="canonical" href="https://docs.automatiko.io/main/0.23.0/components/persistence.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R2G3H6TJRK"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-R2G3H6TJRK')</script>
    <link rel="icon" href="../../../_/img/automatiko-logo-circle.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.automatiko.io"><img src="../../../_/img/automatiko-logo-circle.png" width="52px"/>Automatiko</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/automatiko-io">Souce code</a>
            <a class="navbar-item" href="https://github.com/automatiko-io/automatiko-engine/issues">Issues</a>
            <a class="navbar-item" href="https://github.com/automatiko-io/automatiko-engine/blob/master/CONTRIBUTING.md">Contribution</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="main" data-version="0.1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Automatiko Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../about.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../concepts.html">Concepts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../use-cases.html">Use cases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../examples.html">Examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../best-practice.html">Best practice</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="messaging.html">Messaging</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="persistence.html">Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="errors.html">Error handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management.html">Process management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configuration.html">Configuration reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Automatiko Documentation</span>
    <span class="version">0.1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Automatiko Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../0.23.0/about.html">0.23.0</a>
        </li>
        <li class="version">
          <a href="../../0.22.0/about.html">0.22.0</a>
        </li>
        <li class="version">
          <a href="../../0.21.0/about.html">0.21.0</a>
        </li>
        <li class="version">
          <a href="../../0.20.0/about.html">0.20.0</a>
        </li>
        <li class="version">
          <a href="../../0.19.0/about.html">0.19.0</a>
        </li>
        <li class="version">
          <a href="../../0.18.0/about.html">0.18.0</a>
        </li>
        <li class="version">
          <a href="../../0.17.0/about.html">0.17.0</a>
        </li>
        <li class="version">
          <a href="../../0.16.0/about.html">0.16.0</a>
        </li>
        <li class="version">
          <a href="../../0.15.0/about.html">0.15.0</a>
        </li>
        <li class="version">
          <a href="../../0.14.0/about.html">0.14.0</a>
        </li>
        <li class="version">
          <a href="../../0.13.0/about.html">0.13.0</a>
        </li>
        <li class="version">
          <a href="../../0.12.0/about.html">0.12.0</a>
        </li>
        <li class="version">
          <a href="../../0.11.0/about.html">0.11.0</a>
        </li>
        <li class="version">
          <a href="../../0.10.0/about.html">0.10.0</a>
        </li>
        <li class="version">
          <a href="../../0.9.0/about.html">0.9.0</a>
        </li>
        <li class="version">
          <a href="../../0.8.0/about.html">0.8.0</a>
        </li>
        <li class="version">
          <a href="../../0.7.0/about.html">0.7.0</a>
        </li>
        <li class="version">
          <a href="../../0.6.0/about.html">0.6.0</a>
        </li>
        <li class="version">
          <a href="../../0.5.0/about.html">0.5.0</a>
        </li>
        <li class="version">
          <a href="../../0.4.0/about.html">0.4.0</a>
        </li>
        <li class="version">
          <a href="../../0.3.0/about.html">0.3.0</a>
        </li>
        <li class="version">
          <a href="../../0.2.0/about.html">0.2.0</a>
        </li>
        <li class="version is-current">
          <a href="../about.html">0.1.0</a>
        </li>
        <li class="version">
          <a href="../../0.0.0/about.html">0.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../0.23.0/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Automatiko Documentation</a></li>
    <li>Components</li>
    <li><a href="persistence.html">Persistence</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.1.0</button>
  <div class="version-menu">
    <a class="version" href="../../0.23.0/components/persistence.html">0.23.0</a>
    <a class="version" href="../../0.22.0/components/persistence.html">0.22.0</a>
    <a class="version" href="../../0.21.0/components/persistence.html">0.21.0</a>
    <a class="version" href="../../0.20.0/components/persistence.html">0.20.0</a>
    <a class="version" href="../../0.19.0/components/persistence.html">0.19.0</a>
    <a class="version" href="../../0.18.0/components/persistence.html">0.18.0</a>
    <a class="version" href="../../0.17.0/components/persistence.html">0.17.0</a>
    <a class="version" href="../../0.16.0/components/persistence.html">0.16.0</a>
    <a class="version" href="../../0.15.0/components/persistence.html">0.15.0</a>
    <a class="version" href="../../0.14.0/components/persistence.html">0.14.0</a>
    <a class="version" href="../../0.13.0/components/persistence.html">0.13.0</a>
    <a class="version" href="../../0.12.0/components/persistence.html">0.12.0</a>
    <a class="version" href="../../0.11.0/components/persistence.html">0.11.0</a>
    <a class="version" href="../../0.10.0/components/persistence.html">0.10.0</a>
    <a class="version" href="../../0.9.0/components/persistence.html">0.9.0</a>
    <a class="version" href="../../0.8.0/components/persistence.html">0.8.0</a>
    <a class="version" href="../../0.7.0/components/persistence.html">0.7.0</a>
    <a class="version" href="../../0.6.0/components/persistence.html">0.6.0</a>
    <a class="version" href="../../0.5.0/components/persistence.html">0.5.0</a>
    <a class="version" href="../../0.4.0/components/persistence.html">0.4.0</a>
    <a class="version" href="../../0.3.0/components/persistence.html">0.3.0</a>
    <a class="version" href="../../0.2.0/components/persistence.html">0.2.0</a>
    <a class="version is-current" href="persistence.html">0.1.0</a>
    <a class="version" href="../../0.0.0/components/persistence.html">0.0.0</a>
  </div>
</div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Persistence</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Automatiko by default runs without any persistent storage so it can be used
without additional components. Though in many cases workflow instances are
long lived and thus require storage to persist its state.</p>
</div>
<div class="paragraph">
<p>Automatiko comes with several options to chose from</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File system</strong> based storage</p>
</li>
<li>
<p><strong>Database</strong> based storage</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
More is on their way and as soon as they will be implemented they will
be listed here.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_file_system_based_storage"><a class="anchor" href="#_file_system_based_storage"></a>File system based storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most basic but quite powerful storage option is based on file system.
This means each workflow instance will be stored in dedicated file in
configured directory.</p>
</div>
<div class="paragraph">
<p>In addition to file itself, Automatiko will store some metadata that allows
to more efficiently look up instances without loading it completely.</p>
</div>
<div class="paragraph">
<p>Depending on file system capabilities these metadata will be stored as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>extended file attributes if file system supports it</p>
</li>
<li>
<p><code>dot file</code> next to the actual file as a fallback option when file system does
not support extended attributes</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="paragraph">
<p>To use file system based perssitence your service must have following dependency</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.automatiko.addons&lt;/groupId&gt;
  &lt;artifactId&gt;automatiko-filesystem-persistence-addon&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
That each persistence addon comes with job service implementation as well
to provide persistency of timers defined in workflows
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional configuration should be placed in <code>application.properties</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">BuildTime only</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.persistence.type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify what persistence should be used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.persistence.filesystem.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_AUTOMATIKO_PERSISTENCE_FILESYSTEM_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location on file system that will be used to store persistent state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.jobs.type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies type of jobs implementation to be used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.jobs.filesystem.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_AUTOMATIKO_JOBS_FILESYSTEM_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location on file system where jobs persistent state will be stored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.jobs.filesystem.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_AUTOMATIKO_JOBS_FILESYSTEM_THREADS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how many threads should be used for jobs execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This storage option can be used for pretty much any use case but it has certain drawbacks
depending on the file system being used. It might not be the best option when
horizontal scalability is important.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_based_storage"><a class="anchor" href="#_database_based_storage"></a>Database based storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Database based storage is mainly dedicated to cover <code>Database record processing</code>
as it requires workflow data objects to be</p>
</div>
<div class="ulist">
<ul>
<li>
<p>simple types</p>
</li>
<li>
<p>entities</p>
</li>
<li>
<p>collection of entities</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Its main applicability is to store workflow state next to the data it is
processing.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Data model of the workflow becomes an entity as well, which on
database level will be represented as table.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Every workflow definition will be stored in dedicated table that is constructed
based on workflow identifier and version. The table will also have all simple
type data objects in the same table and reference any entity data objects.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/db-persistence-model.png" alt="db persistence model"></span></p>
</div>
<div class="paragraph">
<p>Green tables are those defined as data objects and annotated as entities.
Orange tables are generated based on workflow definitions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vacations is the top level (public) process for handling vacation requests</p>
</li>
<li>
<p>requests is the sub workflow (private) that handles individual request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Blue table is used by jobs service that stores its data in db as well
to support persistent timers defined in the workflow.</p>
</div>
<div class="sect2">
<h3 id="_data_management"><a class="anchor" href="#_data_management"></a>Data management</h3>
<div class="paragraph">
<p>Since workflows operate on database records (entities defined as data objects)
it has an option to manage these records. One of the important aspects is what
should happen to the data after workflow instance completes?</p>
</div>
<div class="paragraph">
<p>There are two options provided by Automatiko</p>
</div>
<div class="ulist">
<ul>
<li>
<p>keep the data as they are at workflow instance completion</p>
</li>
<li>
<p>remove data that the workflow instance has worked with</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default data is not removed at the completion of workflow instance
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h3>
<div class="paragraph">
<p>To use file system based persistence your service must have following dependency</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.automatiko.addons&lt;/groupId&gt;
  &lt;artifactId&gt;automatiko-db-persistence-addon&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
That each persistence addon comes with job service implementation as well
to provide persistency of timers defined in workflows
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional configuration should be placed in <code>application.properties</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">BuildTime only</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.persistence.type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify what persistence should be used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.persistence.db.remove-at-completion</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies if entities created during instance execution should be removed when instance completes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.jobs.db.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_AUTOMATIKO_JOBS_DB_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies interval (in minutes) how often look for another chunk of jobs to execute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.automatiko.jobs.db.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_AUTOMATIKO_JOBS_DB_THREADS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how many threads should be used for job execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p class="text-center">Â© 2020 Automatiko. All rights reserved.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
