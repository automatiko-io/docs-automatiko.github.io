<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Orders :: Automatiko</title>
    <link rel="canonical" href="https://docs.automatiko.io/main/0.32.0/examples/orders.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R2G3H6TJRK"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-R2G3H6TJRK')</script>
    <link rel="icon" href="../../../_/img/automatiko-logo-circle.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.automatiko.io"><img src="../../../_/img/automatiko-logo-circle.png" width="52px"/>Automatiko</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/automatiko-io">Souce code</a>
            <a class="navbar-item" href="https://github.com/automatiko-io/automatiko-engine/issues">Issues</a>
            <a class="navbar-item" href="https://github.com/automatiko-io/automatiko-engine/blob/master/CONTRIBUTING.md">Contribution</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="main" data-version="0.15.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Automatiko Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../about.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../concepts.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../workflow-service.html">Workflow as a service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../workflow-function.html">Workflow as a function</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../workflow-function-flow.html">Workflow as a function flow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../use-cases.html">Use cases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../examples.html">Examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started-bpmn.html">Based on BPMN2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started-sw.html">Based on Serverless Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../best-practice.html">Best practice</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../service-interfaces.html">Service interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/messaging.html">Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/persistence.html">Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/service-invocation.html">Service invocation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/errors.html">Error handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/management.html">Process management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/event-publishers.html">Event publishers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/user-tasks.html">User tasks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/async-execution.html">Async Execution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/files.html">Handling files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../components/audit.html">Audit</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configuration.html">Configuration reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../services/archive.html">Archive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../services/email.html">Send Email</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../services/receive-email.html">Receive Email</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Migration guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration-guide/0.13.0.html">0.13.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration-guide/0.11.0.html">0.11.0</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Automatiko Documentation</span>
    <span class="version">0.15.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Automatiko Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../0.32.0/about.html">0.32.0</a>
        </li>
        <li class="version">
          <a href="../../0.31.0/about.html">0.31.0</a>
        </li>
        <li class="version">
          <a href="../../0.30.1/about.html">0.30.1</a>
        </li>
        <li class="version">
          <a href="../../0.30.0/about.html">0.30.0</a>
        </li>
        <li class="version">
          <a href="../../0.23.0/about.html">0.23.0</a>
        </li>
        <li class="version">
          <a href="../../0.22.0/about.html">0.22.0</a>
        </li>
        <li class="version">
          <a href="../../0.21.0/about.html">0.21.0</a>
        </li>
        <li class="version">
          <a href="../../0.20.0/about.html">0.20.0</a>
        </li>
        <li class="version">
          <a href="../../0.19.0/about.html">0.19.0</a>
        </li>
        <li class="version">
          <a href="../../0.18.0/about.html">0.18.0</a>
        </li>
        <li class="version">
          <a href="../../0.17.0/about.html">0.17.0</a>
        </li>
        <li class="version">
          <a href="../../0.16.0/about.html">0.16.0</a>
        </li>
        <li class="version is-current">
          <a href="../about.html">0.15.0</a>
        </li>
        <li class="version">
          <a href="../../0.14.0/about.html">0.14.0</a>
        </li>
        <li class="version">
          <a href="../../0.13.0/about.html">0.13.0</a>
        </li>
        <li class="version">
          <a href="../../0.12.0/about.html">0.12.0</a>
        </li>
        <li class="version">
          <a href="../../0.11.0/about.html">0.11.0</a>
        </li>
        <li class="version">
          <a href="../../0.10.0/about.html">0.10.0</a>
        </li>
        <li class="version">
          <a href="../../0.9.0/about.html">0.9.0</a>
        </li>
        <li class="version">
          <a href="../../0.8.0/about.html">0.8.0</a>
        </li>
        <li class="version">
          <a href="../../0.7.0/about.html">0.7.0</a>
        </li>
        <li class="version">
          <a href="../../0.6.0/about.html">0.6.0</a>
        </li>
        <li class="version">
          <a href="../../0.5.0/about.html">0.5.0</a>
        </li>
        <li class="version">
          <a href="../../0.4.0/about.html">0.4.0</a>
        </li>
        <li class="version">
          <a href="../../0.3.0/about.html">0.3.0</a>
        </li>
        <li class="version">
          <a href="../../0.2.0/about.html">0.2.0</a>
        </li>
        <li class="version">
          <a href="../../0.1.0/about.html">0.1.0</a>
        </li>
        <li class="version">
          <a href="../../0.0.0/about.html">0.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../0.32.0/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Automatiko Documentation</a></li>
    <li><a href="orders.html">Orders</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.15.0</button>
  <div class="version-menu">
    <a class="version" href="../../0.32.0/examples/orders.html">0.32.0</a>
    <a class="version" href="../../0.31.0/examples/orders.html">0.31.0</a>
    <a class="version" href="../../0.30.1/examples/orders.html">0.30.1</a>
    <a class="version" href="../../0.30.0/examples/orders.html">0.30.0</a>
    <a class="version" href="../../0.23.0/examples/orders.html">0.23.0</a>
    <a class="version" href="../../0.22.0/examples/orders.html">0.22.0</a>
    <a class="version" href="../../0.21.0/examples/orders.html">0.21.0</a>
    <a class="version" href="../../0.20.0/examples/orders.html">0.20.0</a>
    <a class="version" href="../../0.19.0/examples/orders.html">0.19.0</a>
    <a class="version" href="../../0.18.0/examples/orders.html">0.18.0</a>
    <a class="version" href="../../0.17.0/examples/orders.html">0.17.0</a>
    <a class="version" href="../../0.16.0/examples/orders.html">0.16.0</a>
    <a class="version is-current" href="orders.html">0.15.0</a>
    <a class="version" href="../../0.14.0/examples/orders.html">0.14.0</a>
    <a class="version" href="../../0.13.0/examples/orders.html">0.13.0</a>
    <a class="version" href="../../0.12.0/examples/orders.html">0.12.0</a>
    <a class="version" href="../../0.11.0/examples/orders.html">0.11.0</a>
    <a class="version" href="../../0.10.0/examples/orders.html">0.10.0</a>
    <a class="version" href="../../0.9.0/examples/orders.html">0.9.0</a>
    <a class="version" href="../../0.8.0/examples/orders.html">0.8.0</a>
    <a class="version" href="../../0.7.0/examples/orders.html">0.7.0</a>
    <a class="version" href="../../0.6.0/examples/orders.html">0.6.0</a>
    <a class="version" href="../../0.5.0/examples/orders.html">0.5.0</a>
    <a class="version" href="../../0.4.0/examples/orders.html">0.4.0</a>
    <a class="version" href="../../0.3.0/examples/orders.html">0.3.0</a>
    <a class="version" href="../../0.2.0/examples/orders.html">0.2.0</a>
    <a class="version" href="../../0.1.0/examples/orders.html">0.1.0</a>
    <a class="version" href="../../0.0.0/examples/orders.html">0.0.0</a>
  </div>
</div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Orders</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Orders example service demonstrates simple order management solution
that is based on events. All actions taken by a customer are represented
as individual events.</p>
</div>
<div class="paragraph">
<p>Customer starts with <code>creating an empty order</code>, that is like an intent of
placing an order. Orders are uniquely identified e.g. <code>ORDER-1</code>.</p>
</div>
<div class="paragraph">
<p>Based on further searches in the online store, items can be added, removed
or updated in the order.</p>
</div>
<div class="paragraph">
<p>Finally order is placed and then shipped.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/examples-order.png" alt="examples order"></span></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Note that this example is currently not equipped with user facing UI
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_it"><a class="anchor" href="#_run_it"></a>Run it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The only thing that is needed is Apache Kafka running that will be accessible.
It needs to be given as part of run command via environment variable <code>KAFKA_SERVERS</code></p>
</div>
<div class="paragraph">
<p><code>docker run -e KAFKA_SERVERS=KAFKA_HOST:9092 -p 8080:8080 automatiko/event-streams-orders</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To get quickly a running instance of Apache Kafka to run the tests
a spotify kafka container image can be handy, visit
<a href="https://hub.docker.com/r/spotify/kafka/">Docker Hub</a> for details
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>once this is done you can see the fully described service at
 <a href="http://localhost:8080/swagger-ui/#/" class="bare">http://localhost:8080/swagger-ui/#/</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can open your browser <a href="http://localhost:8080/management/processes/ui" class="bare">http://localhost:8080/management/processes/ui</a>
to visualize your running service
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are multiple paths that can be taken during given order</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/orders-workflow.png" alt="orders workflow">
</div>
</div>
<div class="sect2">
<h3 id="_the_happy_path"><a class="anchor" href="#_the_happy_path"></a>The happy path</h3>
<div class="paragraph">
<p>Happy path consists of steps that will lead to successful shipment of gods ordered.</p>
</div>
<div class="paragraph">
<p>Customer actions are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>creating the order with providing details about him/herself</p>
</li>
<li>
<p>adding items</p>
</li>
<li>
<p>optionally items can be changed (like change of quantity) or removed completely</p>
</li>
<li>
<p>order is placed when the items are selected</p>
</li>
<li>
<p>order will calculated, in case of discounts the price will be adjusted</p>
</li>
<li>
<p>shipment is created with unique number</p>
</li>
<li>
<p>gods are shipped to customer</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_try_it"><a class="anchor" href="#_try_it"></a>Try it</h4>
<div class="paragraph">
<p>Follow steps in the <code>Details</code> section to see the happy path in action.</p>
</div>
<details>
<div class="content">
<div class="paragraph">
<p>Here are the steps to try out with happy path</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create new order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Created"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add item to the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Update item to add/remove</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use positive number for quantity to add more items, use negative
to deduct items or set it to 0 to remove given item completely
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Place the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Placed"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ship the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Shipped"
  }
}</pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_the_abandoned_path"><a class="anchor" href="#_the_abandoned_path"></a>The abandoned path</h3>
<div class="paragraph">
<p>Abandoned path is taken when customer creates order add items to it but never placed the order.
The service tracks time of every order until it&#8217;s placed. In this simple scenario
this timeout is set to 10 minutes. That means that customer has 10 minutes to place
the order from the time it was created.</p>
</div>
<div class="sect3">
<h4 id="_try_it_2"><a class="anchor" href="#_try_it_2"></a>Try it</h4>
<div class="paragraph">
<p>Follow steps in the <code>Details</code> section to see the abandoned path in action.</p>
</div>
<details>
<div class="content">
<div class="paragraph">
<p>Here are the steps to try out with happy path</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create new order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Created"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add item to the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Update item to add/remove</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use positive number for quantity to add more items, use negative
to deduct items or set it to 0 to remove given item completely
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait for the timeout to happen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After 10 minutes from the creation time, the order will be automatically closed.</p>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_the_cancelled_path"><a class="anchor" href="#_the_cancelled_path"></a>The cancelled path</h3>
<div class="paragraph">
<p>Cancelled path covers a case when customer creates order, add items to it
but then decides to not finalize it and explicitly cancels the order.</p>
</div>
<div class="paragraph">
<p>Cancellation can be at any time even when the order was placed. In such a case
shipment has already been requested and thus requires to be aborted.
An abort of already requested shipment is done via compensation that is
done automatically based on the state or the order.</p>
</div>
<div class="sect3">
<h4 id="_try_it_3"><a class="anchor" href="#_try_it_3"></a>Try it</h4>
<div class="paragraph">
<p>Follow steps in the <code>Details</code> section to see the cancelled path in action.</p>
</div>
<details>
<div class="content">
<div class="paragraph">
<p>Here are the steps to try out with cancelled path</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create new order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Created"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add item to the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Update item to add/remove</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use positive number for quantity to add more items, use negative
to deduct items or set it to 0 to remove given item completely
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Place the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Placed"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Cancel the order which will compensate requested shipment</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Cancelled"
  }
}</pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_the_change_address_path"><a class="anchor" href="#_the_change_address_path"></a>The change address path</h3>
<div class="paragraph">
<p>Since orders can take a bit before they are shipped, customer can change the address
and thus the order should be made aware of such change.</p>
</div>
<div class="paragraph">
<p>This operation is done through different topic where all events for a given customer are
being published. Similar to orders, each customer is uniquely identified
by his or her email address.</p>
</div>
<div class="paragraph">
<p>Orders service will track all active orders for given customer and
whenever customer record is published it will consume it and verify if the change
is relevant to the process. In this example verification is done based
on address of the customer. It will only update the order when address is
different than the one in the order.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Regardless how many orders are active for given customer all of them
will be automatically updated
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_try_it_4"><a class="anchor" href="#_try_it_4"></a>Try it</h4>
<div class="paragraph">
<p>Follow steps in the <code>Details</code> section to see the change address path in action.</p>
</div>
<details>
<div class="content">
<div class="paragraph">
<p>Here are the steps to try out with change address path</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create new order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Created"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add item to the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Update item to add/remove</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use positive number for quantity to add more items, use negative
to deduct items or set it to 0 to remove given item completely
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "item" : {
    "articleId" : "1234",
    "name" : "pen",
    "price" : 10,
    "quantity" : 4
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Place the order</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>orders</code></p>
</li>
<li>
<p>Set record key to <code>ORDER-1</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "order": {
    "customer": {
      "address": {
        "city": "New York",
        "country": "US",
        "street": "Main Street 1",
        "zipCode": "10000"
      },
      "email": "john@doe.org",
      "firstName": "John",
      "lastName": "Doe",
      "phone": "123456"
    },
    "orderDate": "2020-12-07",
    "orderNumber": "ORDER-1",
    "status": "Placed"
  }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Update customer&#8217;s address</p>
<div class="ulist">
<ul>
<li>
<p>Topic <code>customers</code></p>
</li>
<li>
<p>Set record key to <code>john@doe.org</code></p>
</li>
<li>
<p>Set the record value to</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "firstName": "John",
    "lastName": "Doe",
    "email": "john@doe.org",
    "phone": "123456",
    "address": {
        "street": "Second avenue 4",
        "city": "Boston",
        "zipCode": "00022",
        "country": "US"
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Display the order again to see the address change for the customer.</p>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_source_code"><a class="anchor" href="#_source_code"></a>Source code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Complete source code of this example can be found
<a href="https://github.com/automatiko-io/automatiko-examples/tree/main/event-streams-orders">in GitHub</a></p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p class="text-center">Â© 2020 Automatiko. All rights reserved.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
