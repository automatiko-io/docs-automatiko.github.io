<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Workflow as a Function (WaaF) :: Automatiko</title>
    <link rel="canonical" href="https://docs.automatiko.io/main/0.21.0/workflow-function.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R2G3H6TJRK"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-R2G3H6TJRK')</script>
    <link rel="icon" href="../../_/img/automatiko-logo-circle.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.automatiko.io"><img src="../../_/img/automatiko-logo-circle.png" width="52px"/>Automatiko</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/automatiko-io">Souce code</a>
            <a class="navbar-item" href="https://github.com/automatiko-io/automatiko-engine/issues">Issues</a>
            <a class="navbar-item" href="https://github.com/automatiko-io/automatiko-engine/blob/master/CONTRIBUTING.md">Contribution</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="main" data-version="0.15.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="about.html">Automatiko Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="about.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="concepts.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="workflow-service.html">Workflow as a service</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="workflow-function.html">Workflow as a function</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="workflow-function-flow.html">Workflow as a function flow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="use-cases.html">Use cases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="examples.html">Examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started-bpmn.html">Based on BPMN2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started-sw.html">Based on Serverless Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="best-practice.html">Best practice</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="service-interfaces.html">Service interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/messaging.html">Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/persistence.html">Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/service-invocation.html">Service invocation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/errors.html">Error handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/management.html">Process management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/event-publishers.html">Event publishers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/user-tasks.html">User tasks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/async-execution.html">Async Execution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/files.html">Handling files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="components/audit.html">Audit</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration.html">Configuration reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="services/archive.html">Archive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="services/email.html">Send Email</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="services/receive-email.html">Receive Email</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Migration guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migration-guide/0.13.0.html">0.13.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migration-guide/0.11.0.html">0.11.0</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Automatiko Documentation</span>
    <span class="version">0.15.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Automatiko Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../0.21.0/about.html">0.21.0</a>
        </li>
        <li class="version">
          <a href="../0.20.0/about.html">0.20.0</a>
        </li>
        <li class="version">
          <a href="../0.19.0/about.html">0.19.0</a>
        </li>
        <li class="version">
          <a href="../0.18.0/about.html">0.18.0</a>
        </li>
        <li class="version">
          <a href="../0.17.0/about.html">0.17.0</a>
        </li>
        <li class="version">
          <a href="../0.16.0/about.html">0.16.0</a>
        </li>
        <li class="version is-current">
          <a href="about.html">0.15.0</a>
        </li>
        <li class="version">
          <a href="../0.14.0/about.html">0.14.0</a>
        </li>
        <li class="version">
          <a href="../0.13.0/about.html">0.13.0</a>
        </li>
        <li class="version">
          <a href="../0.12.0/about.html">0.12.0</a>
        </li>
        <li class="version">
          <a href="../0.11.0/about.html">0.11.0</a>
        </li>
        <li class="version">
          <a href="../0.10.0/about.html">0.10.0</a>
        </li>
        <li class="version">
          <a href="../0.9.0/about.html">0.9.0</a>
        </li>
        <li class="version">
          <a href="../0.8.0/about.html">0.8.0</a>
        </li>
        <li class="version">
          <a href="../0.7.0/about.html">0.7.0</a>
        </li>
        <li class="version">
          <a href="../0.6.0/about.html">0.6.0</a>
        </li>
        <li class="version">
          <a href="../0.5.0/about.html">0.5.0</a>
        </li>
        <li class="version">
          <a href="../0.4.0/about.html">0.4.0</a>
        </li>
        <li class="version">
          <a href="../0.3.0/about.html">0.3.0</a>
        </li>
        <li class="version">
          <a href="../0.2.0/about.html">0.2.0</a>
        </li>
        <li class="version">
          <a href="../0.1.0/about.html">0.1.0</a>
        </li>
        <li class="version">
          <a href="../0.0.0/about.html">0.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../0.21.0/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="about.html">Automatiko Documentation</a></li>
    <li><a href="concepts.html">Concepts</a></li>
    <li><a href="workflow-function.html">Workflow as a function</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.15.0</button>
  <div class="version-menu">
    <a class="version" href="../0.21.0/workflow-function.html">0.21.0</a>
    <a class="version" href="../0.20.0/workflow-function.html">0.20.0</a>
    <a class="version" href="../0.19.0/workflow-function.html">0.19.0</a>
    <a class="version" href="../0.18.0/workflow-function.html">0.18.0</a>
    <a class="version" href="../0.17.0/workflow-function.html">0.17.0</a>
    <a class="version" href="../0.16.0/workflow-function.html">0.16.0</a>
    <a class="version is-current" href="workflow-function.html">0.15.0</a>
    <a class="version" href="../0.14.0/workflow-function.html">0.14.0</a>
    <a class="version" href="../0.13.0/workflow-function.html">0.13.0</a>
    <a class="version" href="../0.12.0/workflow-function.html">0.12.0</a>
    <a class="version" href="../0.11.0/workflow-function.html">0.11.0</a>
    <a class="version" href="../0.10.0/workflow-function.html">0.10.0</a>
    <a class="version is-missing" href="../0.9.0/about.html">0.9.0</a>
    <a class="version is-missing" href="../0.8.0/about.html">0.8.0</a>
    <a class="version is-missing" href="../0.7.0/about.html">0.7.0</a>
    <a class="version is-missing" href="../0.6.0/about.html">0.6.0</a>
    <a class="version is-missing" href="../0.5.0/about.html">0.5.0</a>
    <a class="version is-missing" href="../0.4.0/about.html">0.4.0</a>
    <a class="version is-missing" href="../0.3.0/about.html">0.3.0</a>
    <a class="version is-missing" href="../0.2.0/about.html">0.2.0</a>
    <a class="version is-missing" href="../0.1.0/about.html">0.1.0</a>
    <a class="version" href="../0.0.0/workflow-function.html">0.0.0</a>
  </div>
</div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Workflow as a Function (WaaF)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/workflow-as-function.png" alt="workflow as function">
</div>
</div>
<div class="paragraph">
<p>Workflow as a Function is dedicated for short lived operations that usually last
no longer that a second. They are expected to be fast and small in size both at runtime
and at boot time.</p>
</div>
<div class="paragraph">
<p>Workflow as a Function typically targets deployments in more constrained environments such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/lambda/">AWS Lambda</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/run">Google Cloud Run</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview">Azure Functions</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>however are not strictly limited to them, as they can easily be invoked
over HTTP with both <code>POST</code> and <code>GET</code> endpoints, making them deployable virtually
anywhere.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Functions can map data from payloads (<code>POST</code>) as well as from query parameters
(<code>GET</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of the number of activities it contains, the workflow is always
exposed as a single function with its id being its <code>public</code> identifier, namely the function name.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_get_started"><a class="anchor" href="#_get_started"></a>Get started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started with Workflow as a Function users can take advantage of ready to use maven archetype
to generate the project structure</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>automatiko-function-archetype</strong> - Tailored project type for workflow as a function use case</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a ready to use command to generate project based on <strong>automatiko-function-archetype</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">mvn archetype:generate                                      \
  -DarchetypeGroupId=io.automatiko.archetypes               \
  -DarchetypeArtifactId=automatiko-function-archetype       \
  -DarchetypeVersion=LATEST                                 \
  -DgroupId=com.acme.workflows                              \
  -DartifactId=workfow-function</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generated project has three maven profile defined that represents the target environment to deploy your function</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>azure</code> - for Azure Functions</p>
</li>
<li>
<p><code>gcp</code> - for Google Cloud Functions</p>
</li>
<li>
<p><code>aws-lambda</code> - for Amazon Lambda</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_project"><a class="anchor" href="#_configure_project"></a>Configure project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the project is bootstrapped, it needs to be configured according to the needs. There are two places where
configuration is done</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pom.xml</code> - definition of the dependencies and Automatiko addons to be used</p>
</li>
<li>
<p><code>application.properties</code> - all configuration parameters are defined there (found in <code>src/main/resources</code> directory)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A complete configuration of Automatiko specific configuration parameters can be found here, Quarkus specific configuration
parameters can be found here.</p>
</div>
<div class="sect2">
<h3 id="_azure_functions"><a class="anchor" href="#_azure_functions"></a>Azure functions</h3>
<div class="paragraph">
<p>Azure configuration uses <code>azure-functions-maven-plugin</code> and thus requires additional configuration to be set.
Either by editing pom.xml file or using <code>-D</code> on the command lines. Here are the properties that must be set</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>functionResourceGroup</code> - resource group in your Azure subscription to be used</p>
</li>
<li>
<p><code>functionAppPlan</code> - application plan to be used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once this is done Azure function deployment can be done via maven plugin</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">mvn clean package azure-functions:deploy -Pazure</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will give you as output a <code>HTTP Trigger Urls</code> that points to your function.</p>
</div>
</div>
<div class="sect2">
<h3 id="_google_cloud_functions"><a class="anchor" href="#_google_cloud_functions"></a>Google Cloud functions</h3>
<div class="paragraph">
<p>For Google Cloud functions it should be build with <code>gcp</code> profile</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">mvn clean package -Pgcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then deployed to your Google Cloud project using <code>gcloud</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">gcloud functions deploy automatiko-user-registration-example \
  --entry-point=io.quarkus.gcp.functions.http.QuarkusHttpFunction \
  --runtime=java11 --trigger-http --source=target/deployment</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will give you as output a <code>httpsTrigger.url</code> that points to your function.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aws_lambda"><a class="anchor" href="#_aws_lambda"></a>AWS Lambda</h3>
<div class="paragraph">
<p>For AWS Lambda functions it should be build with <code>aws-lambda</code> profile</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">mvn clean package -Paws-lambda</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then deployed to your AWS Lambda project using <code>sam</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">sam deploy -t target/sam.jvm.yaml -g</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will give you output similar to following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">---------------------------------------------------------------------------------------
Outputs
---------------------------------------------------------------------------------------
Key                 UserRegistrationFunctionApi
Description         URL for application
Value               https://xqe0c0addh.execute-api.us-east-2.amazonaws.com/
----------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above url can be used to trigger lambda functions by appending the context path.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following is a list of examples that can be tried out to see Workflow as a Function in action</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Function examples</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BPMN based workflow for user registration that uses Swagger PetStore as user repository. Ready to be deployed to
Azure Functions, Google Cloud Functions and Amazon Lambda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/automatiko-io/automatiko-examples/tree/main/user-registration-function">link</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p class="text-center">© 2020 Automatiko. All rights reserved.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
